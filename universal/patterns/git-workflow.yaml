# Git Workflow and Commit Patterns
# Best practices for git usage and commit conventions

version: "1.0"
category: "git-workflow"
last_updated: "2026-01-04"

commit_message_format:
  structure: |
    <type>: <summary>

    <body>

    <footer>

  types:
    feat: "New feature or functionality"
    fix: "Bug fix"
    docs: "Documentation changes"
    style: "Code style changes (formatting, no logic changes)"
    refactor: "Code refactoring (no feature changes or bug fixes)"
    test: "Adding or updating tests"
    chore: "Build process or auxiliary tool changes"
    perf: "Performance improvements"

  examples:
    good_commit: |
      feat: Implement Track 6 Phase 1-3 - WebSocket Real-time Updates Foundation

      Implemented comprehensive WebSocket infrastructure for real-time updates:

      ## Features Added
      - ConnectionManager for WebSocket lifecycle management
      - Room-based broadcasting for targeted message delivery
      - EventBroadcaster with typed event system
      - Integration with ProgressService
      - FastAPI WebSocket endpoints

      ## Files Created
      - src/interfaces/api/websocket/connection_manager.py (390 lines)
      - src/interfaces/api/websocket/events.py (390 lines)
      - src/interfaces/api/routes/websocket.py (230 lines)

      ## Tests
      - 45+ unit tests with 95% coverage
      - Integration tests for end-to-end flows

      Related to Track 6: WebSocket Real-time Updates

      ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

      Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>

    bad_commit: |
      # Too vague
      update files

      # No context
      fix bug

      # No details
      add websocket

  summary_guidelines:
    - "Start with type prefix: feat:, fix:, docs:, etc."
    - "Use imperative mood: 'Add feature' not 'Added feature'"
    - "Keep under 72 characters"
    - "Be specific and descriptive"
    - "Reference track/spec if applicable"

  body_guidelines:
    - "Explain WHAT changed and WHY"
    - "Use bullet points for multiple changes"
    - "Include file counts for large changes"
    - "Reference related issues/specs"
    - "Describe breaking changes"

  footer_guidelines:
    - "Add Co-Authored-By for AI assistance"
    - "Reference related issues: 'Closes #123'"
    - "Note breaking changes: 'BREAKING CHANGE:'"

branch_strategy:
  naming_convention:
    feature: "<number>-<short-description>"
    bugfix: "fix-<issue-number>-<description>"
    hotfix: "hotfix-<description>"

    examples:
      - "007-task-list-implementation"
      - "fix-123-websocket-disconnect"
      - "hotfix-critical-security-issue"

  workflow:
    - step: "Create feature branch from main"
      command: "git checkout -b 007-task-list-implementation"

    - step: "Make changes and commit frequently"
      command: "git add . && git commit -m 'feat: ...'"

    - step: "Keep branch updated with main"
      command: "git pull origin main --rebase"

    - step: "Push to remote"
      command: "git push origin 007-task-list-implementation"

    - step: "Create pull request"
      note: "Include description, screenshots, test results"

    - step: "Address review comments"
      command: "git commit -m 'fix: address review comments'"

    - step: "Merge to main after approval"
      method: "Squash and merge (preferred) or merge commit"

  main_branch:
    name: "main"
    protection:
      - "Require pull request reviews"
      - "Require status checks to pass"
      - "Require branch to be up to date"
      - "No direct pushes to main"

commit_patterns:
  atomic_commits:
    principle: "Each commit should be a complete, working unit"

    good_example: |
      # Commit 1: Add feature
      feat: Add user authentication

      # Commit 2: Add tests
      test: Add tests for authentication

      # Commit 3: Update docs
      docs: Document authentication flow

    bad_example: |
      # Single commit with unrelated changes
      feat: Add auth, fix bug, update docs, refactor code

  meaningful_commits:
    good: |
      fix: Resolve circular import in ETL modules

      Used TYPE_CHECKING guard to avoid circular dependency between
      extract.py and orchestrate.py modules.

    bad: |
      WIP
      fix stuff
      updates

  commit_frequency:
    guideline: "Commit frequently but not too granularly"

    too_infrequent: "Commit after 500 lines of changes"
    good: "Commit after completing logical unit of work"
    too_frequent: "Commit after every single line change"

best_practices:
  before_commit:
    - name: "Run tests"
      command: "pytest"

    - name: "Run linters"
      command: "ruff check --fix ."

    - name: "Run type checker"
      command: "mypy src/"

    - name: "Review changes"
      command: "git diff --staged"

  commit_workflow:
    - step: "Stage related changes"
      command: "git add src/module/"

    - step: "Review staged changes"
      command: "git diff --staged"

    - step: "Commit with descriptive message"
      command: 'git commit -m "feat: add feature"'

    - step: "Push to remote regularly"
      command: "git push"

  handling_mistakes:
    - issue: "Wrong commit message"
      solution: "git commit --amend -m 'correct message'"
      caution: "Only if not pushed!"

    - issue: "Forgot to include file"
      solution: "git add file && git commit --amend --no-edit"
      caution: "Only if not pushed!"

    - issue: "Committed to wrong branch"
      solution: |
        git reset --soft HEAD~1
        git stash
        git checkout correct-branch
        git stash pop
        git commit

    - issue: "Need to undo last commit"
      solution: "git reset --soft HEAD~1"
      note: "Keeps changes staged"

git_commands:
  daily_use:
    - name: "Check status"
      command: "git status"
      when: "Before and after changes"

    - name: "View changes"
      command: "git diff"
      when: "Before staging"

    - name: "Stage changes"
      command: "git add <file>"
      note: "Prefer specific files over 'git add .'"

    - name: "Commit"
      command: "git commit -m 'message'"
      note: "Or git commit for detailed message in editor"

    - name: "Push"
      command: "git push"
      note: "Push regularly to backup work"

    - name: "Pull latest"
      command: "git pull --rebase"
      when: "Before starting work and before pushing"

  branch_management:
    - name: "List branches"
      command: "git branch -a"

    - name: "Create branch"
      command: "git checkout -b feature-name"

    - name: "Switch branch"
      command: "git checkout branch-name"

    - name: "Delete local branch"
      command: "git branch -d feature-name"

    - name: "Delete remote branch"
      command: "git push origin --delete feature-name"

  history:
    - name: "View commit log"
      command: "git log --oneline -10"

    - name: "View changes in commit"
      command: "git show <commit-hash>"

    - name: "Search commits"
      command: "git log --grep='websocket'"

    - name: "View file history"
      command: "git log --follow <file>"

  advanced:
    - name: "Interactive rebase"
      command: "git rebase -i HEAD~3"
      use: "Squash, reorder, or edit commits"

    - name: "Cherry-pick commit"
      command: "git cherry-pick <commit-hash>"
      use: "Apply specific commit from another branch"

    - name: "Stash changes"
      command: "git stash"
      use: "Temporarily save uncommitted changes"

    - name: "Apply stash"
      command: "git stash pop"

gitignore_patterns:
  python:
    - "__pycache__/"
    - "*.py[cod]"
    - ".venv/"
    - ".pytest_cache/"
    - ".mypy_cache/"
    - ".coverage"
    - "*.egg-info/"

  environment:
    - ".env"
    - ".env.*"
    - "!.env.example"

  ide:
    - ".vscode/"
    - ".idea/"
    - "*.iml"

  data:
