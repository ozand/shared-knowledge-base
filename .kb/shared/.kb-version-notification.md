# Shared KB Version Notification

**Current Version:** 4.0.1
**Release Date:** 2026-01-08
**Commit:** ec5601e

---

## üö® Critical Updates Available

### Your Version: {DETECT_CURRENT_VERSION}
### Latest Version: 4.0.1

---

## What Changed in v4.0.1

**Hotfix:** Fixed `kb_domains.py` compatibility + added agent instructions

### Fixed
- `kb_domains.py` TypeError with flat domain format (line 415-437)
- Tool now supports both flat (int) and nested (dict) formats

### Added
- `AGENT-UPDATE-INSTRUCTIONS.md` (600+ lines) - Complete agent update guide
- `KB-UPDATE-QUICK-REFERENCE.md` (200+ lines) - Quick reference for agents
- `DOMAIN-INDEX-SCHEMA.md` (300+ lines) - Official v4.0.0 format spec
- `PROJECT-UPDATE-ISSUES.md` - Analysis of real-world update issue
- `test_domain_index_validation.py` - 15 tests for validation

### Updated
- `.claude/CLAUDE.md` - Added Shared KB Updates section
- `docs/UPGRADE-4.0.md` - Added "For Agents" critical instructions
- `CHANGELOG.md` - Added v4.0.1 entry

### Impact
- ‚úÖ Agents now have strict rules: NEVER modify `.kb/shared/` files
- ‚úÖ Clear distinction between tool bugs vs data format issues
- ‚úÖ Prevents future git conflicts from incorrect modifications
- ‚úÖ Claude Code documentation now organized as proper knowledge domain

---

## Action Required

### Step 1: Update Shared KB

```bash
cd .kb/shared
git pull origin main
cd ../..
```

### Step 2: Rebuild Index

```bash
python tools/kb.py index --force -v
```

### Step 3: Verify

```bash
python tools/kb_domains.py list
```

Expected output:
```
Domains in index:
  docker               11 entries
  universal             8 entries
  claude-code           4 entries
  ...
```

---

## ‚ö†Ô∏è If You Encounter Errors

### Error: "TypeError: 'int' object is not subscriptable"

**Cause:** Old `kb_domains.py` doesn't support v4.0.0 flat format

**Solution:** Update tool from Shared KB:
```bash
cp .kb/shared/../tools/kb_domains.py tools/kb_domains.py
```

**DO NOT:**
- ‚ùå Modify `_domain_index.yaml` format
- ‚ùå Add fields like `token_estimate`, `tags`, `description`

**INSTEAD:**
- ‚úÖ Update tool to handle data format
- ‚úÖ Report issue to Shared KB repository

---

## üìö New Agent Instructions

After updating to v4.0.1, agents must read:

1. **`@for-claude-code/AGENT-UPDATE-INSTRUCTIONS.md`** (Complete guide)
2. **`@for-claude-code/KB-UPDATE-QUICK-REFERENCE.md`** (Quick reference)

**üö® 3 Golden Rules:**
- ‚õî **NEVER** modify files in `.kb/shared/` (submodule is read-only)
- ‚úÖ **DATA** is source of truth (if tool breaks ‚Üí tool has bug)
- ‚ùì **When unsure** ‚Üí ASK, don't fix

---

## üìñ Full Documentation

- **Update Instructions:** `@for-projects/UPDATE-SHARED-KB.md`
- **Changelog:** `@CHANGELOG.md`
- **Agent Instructions:** `@for-claude-code/AGENT-UPDATE-INSTRUCTIONS.md`
- **Quick Reference:** `@for-claude-code/KB-UPDATE-QUICK-REFERENCE.md`

---

## üîó Links

- **Repository:** https://github.com/ozand/shared-knowledge-base
- **Releases:** https://github.com/ozand/shared-knowledge-base/releases
- **Issues:** https://github.com/ozand/shared-knowledge-base/issues

---

**Auto-generated:** This file is automatically updated with each release
**Last Check:** {CURRENT_DATE}
