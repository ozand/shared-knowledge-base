# Claude Code Shared Model Pattern
# Best practices for organizing .claude files across multiple projects and teams

version: "1.0"
category: "agent-workflow"
last_updated: "2026-01-06"

patterns:
  - id: "CLAUDE-CODE-SHARED-MODEL-001"
    title: "Claude Code Shared Knowledge Model for Multiple Projects"
    severity: "high"
    scope: "universal"
    tags: ["claude-code", "shared-knowledge", "configuration", "monorepo", "team-collaboration", "claude-md", "skills", "agents"]

    problem: |
      Teams using Claude Code across multiple projects face:
      - Duplicated configuration in each project
      - Inconsistent coding standards
      - Knowledge silos (each developer works differently)
      - Difficult onboarding for new team members
      - No shared SKILLS or AGENTS across projects
      - Token waste from loading redundant context

      **Real scenarios:**
      - New developer asks: "How do we structure components?" Gets 3 different answers
      - Code reviews take 5 cycles due to style inconsistencies
      - Test coverage varies from 10% to 80% across services
      - Each project reinvents the same patterns

    impact: |
      - **Onboarding:** Days instead of hours
      - **Code Review:** 5 cycles → 1-2 cycles
      - **Test Coverage:** 30% average → 80%+ consistent
      - **Knowledge:** Lost when people leave → Preserved in .claude/
      - **New Projects:** Start from scratch → Inherit shared standards

    solution: |
      **Shared Knowledge Model with Hierarchical Configuration**

      ## Core Principle

      Use **Project Scope** (.claude/ committed to git) for shared team knowledge:

      ```
      monorepo/
      ├── .claude/                    ← SHARED BY ALL PROJECTS
      │   ├── CLAUDE.md              (Navigation hub, ~300 lines)
      │   ├── settings.json          (Feature flags)
      │   ├── standards/             (Team knowledge)
      │   ├── skills/                (Reusable capabilities)
      │   ├── agents/                (Automation)
      │   └── team/                  (Workflows, principles)
      ├── packages/package-a/.claude/  (Package-specific)
      └── services/api/.claude/         (Service-specific)
      ```

      **Configuration Hierarchy (priority order):**

      1. **Local Scope** (highest priority)
         - `.claude/*.local.*`
         - NOT in git (.gitignore)
         - Personal overrides

      2. **Project Scope** ← **FOR SHARED KNOWLEDGE** ⭐
         - `<repo>/.claude/`
         - ✅ IN GIT (team shared)
         - Standards, skills, agents

      3. **User Scope**
         - `~/.claude/`
         - Personal preferences
         - Not shared across PCs

      4. **Enterprise Scope** (lowest priority)
         - `/etc/claude/` or `C:\ProgramData\claude\`
         - Corporate policies
         - IT-managed

    best_practices:
      - practice: "Keep root CLAUDE.md lean (~300 lines)"
        reason: "Acts as navigation hub, references detailed standards"
        pattern: |
          CLAUDE.md should:
          - Point to @standards/architecture.md
          - Point to @standards/coding-standards.md
          - NOT contain all details (lazy loading)
          - Be ~300 lines max

      - practice: "Use progressive disclosure"
        reason: "Load details on demand, save tokens"
        workflow: |
          1. Load CLAUDE.md (300 lines)
          2. User references @standards/architecture.md
          3. ONLY THEN load architecture.md
          4. Result: Efficient token usage

      - practice: "Single source of truth"
        reason: "Avoid duplication, prevent inconsistencies"
        example: |
          ❌ WRONG: Error handling rules in:
             - CLAUDE.md
             - standards/error-handling.md
             - docs/best-practices.md

          ✅ CORRECT: error-handling.md (authoritative)
             All others: @standards/error-handling.md

      - practice: "Commit .claude/ to git, exclude .local files"
        reason: "Team shares standards, individuals keep personal overrides"
        gitignore: |
          .claude/*.local.*
          .claude/.local/
          # But .claude/ itself IS committed!

      - practice: "Create reusable SKILLS"
        reason: "Eliminate repetitive prompting"
        examples: |
          - testing/ (SKILL.md for test generation)
          - refactoring/ (SKILL.md for code improvement)
          - documentation/ (SKILL.md for doc generation)

      - practice: "Automate with AGENTS"
        reason: "Reduce manual work, enforce standards"
        examples: |
          - code-review-agent (PR review automation)
          - deployment-agent (deploy orchestration)
          - testing-agent (test optimization)

    implementation: "@references/CLAUDE-CODE-SHARED-MODEL-001-implementation.md"

    scaling_guide: "@references/CLAUDE-CODE-SHARED-MODEL-001-implementation.md"

    real_world_examples: "@references/CLAUDE-CODE-SHARED-MODEL-001-examples.md"

    common_mistakes: "@references/CLAUDE-CODE-SHARED-MODEL-001-examples.md"

    verification_checklist: "@references/CLAUDE-CODE-SHARED-MODEL-001-setup.md"

    code_example: "@references/CLAUDE-CODE-SHARED-MODEL-001-setup.md"

    troubleshooting: "@references/CLAUDE-CODE-SHARED-MODEL-001-setup.md"

    related_patterns:
      - SHARED-KB-SETUP-001 (Shared KB sparse checkout)
      - GIT-SUBMODULE-001 (Submodule integration)
      - AGENT-HANDOFF-001 (Cross-project collaboration)

    references:
      - "Claude Code Docs: https://code.claude.com/docs/en"
      - "Claude Skills: https://www.claudeskills.org/docs/agent-skills"
      - "Using CLAUDE.md: https://claude.com/blog/using-claude-md-files"
      - "Best practices: https://www.anthropic.com/engineering/claude-code-best-practices"

    metadata:
      created_at: "2026-01-06"
      author: "Shared KB Curator"
      source: "Perplexity research v17 + best practices compilation"
      reusable: true
      severity_level: 2
      difficulty: "intermediate"
      pattern_type: "architecture"
      applicable_to: ["teams", "monorepos", "multi-project", "claude-code-users"]
