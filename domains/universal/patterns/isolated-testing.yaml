version: '1.0'
category: testing
last_updated: '2026-01-06'
patterns:
- id: ISOLATED-TEST-001
  title: Isolated Environment Testing for Code Changes
  severity: high
  scope: universal
  tags:
  - testing
  - isolated
  - pr-review
  - git
  - safety
  - quality-control
  problem: 'Testing code changes directly in the main repository is dangerous:


    - **Repository Contamination:** Test files, branches, build artifacts pollute
    repo

    - **Difficult Cleanup:** Hard to undo all changes after testing

    - **Git State Confusion:** Test branches mixed with real work

    - **Build Artifact Pollution:** Cache files, binaries, __pycache__ added

    - **Time-Consuming Cleanup:** Have to carefully revert everything

    - **Risk of Accidental Commit:** Might commit test changes by mistake


    **Real Example:**

    When reviewing PR #6 (kb_config.py fix), testing in main repository would:

    - Create test branches

    - Add build artifacts

    - Modify .git/config

    - Risk contaminating git history

    '
  symptoms:
  - Build artifacts in repository
  - Test branches in git log
  - .git/config modified
  - Hard to clean up after testing
  - Fear of breaking main repository
  root_cause: '1. **No Isolated Testing Strategy:** Test in-place by default

    2. **Convenience Over Safety:** Easier to test in main repo

    3. **No Cleanup Process:** Don''t know how to cleanly test

    4. **Git Ignorance:** Unfamiliar with git worktree or clone strategies

    5. **Time Pressure:** Want to test quickly, skip isolation

    '
  solution: '@references/ISOLATED-TEST-001-strategies.md'
  best_practices:
  - practice: Always use isolated environment for PR review
    reason: Complete safety, easy cleanup
  - practice: Use /tmp for temporary clones
    reason: Automatically cleaned on reboot
  - practice: Delete test directory immediately after testing
    reason: No leftover artifacts
  - practice: Test destructive operations in clone
    reason: Can't break main repo
  - practice: Use descriptive directory names
    reason: Easy to identify (pr-6-test, pr-4-test)
  - practice: Parallel testing with separate directories
    reason: Test multiple PRs simultaneously
  anti_patterns:
  - anti_pattern: Testing directly in main repository
    risks:
    - Accidental commits
    - Git history pollution
    - Difficult cleanup
    - Build artifacts in repo
    - Lost work if stash messed up
  - anti_pattern: Using master branch for experiments
    risks:
    - Mix experimental with production
    - Hard to undo
    - Git state confusion
  - anti_pattern: Forgetting which repo you're in
    risks:
    - Modifying wrong repository
    - Commits in wrong branch
    - Lost work
  workflow:
    isolated_testing_checklist:
    - step: Create temporary directory
      location: /tmp
      command: cd /tmp && mkdir pr-test && cd pr-test
    - step: Clone repository
      command: git clone git@github.com:user/repo.git .
      note: Period at end clones into current dir
    - step: Fetch and checkout PR branch
      commands:
      - git fetch origin pull/<number>/head:pr-branch
      - git checkout pr-branch
    - step: Run tests
      example: 'python tools/kb.py validate .

        python tools/kb_patterns.py find-universal

        # ... more tests

        '
    - step: Verify results
      question: All tests passed?
    - step: Cleanup
      commands:
      - cd /tmp
      - rm -rf pr-test
      note: Complete cleanup, no traces
    parallel_testing:
      scenario: Testing multiple PRs simultaneously
      process: 'cd /tmp

        # PR #6

        mkdir pr-6-test && cd pr-6-test

        git clone git@github.com:user/repo.git .

        git fetch origin pull/6/head:pr6 && git checkout pr6


        # In another terminal

        cd /tmp

        # PR #4

        mkdir pr-4-test && cd pr-4-test

        git clone git@github.com:user/repo.git .

        git fetch origin pull/4/head:pr4 && git checkout pr4


        # Test both independently

        '
      advantage: No interference between PRs
  real_world_examples:
    example_1:
      pr: 'PR #6 - kb_config.py fix'
      strategy: Temporary Clone
      commands: 'cd /tmp && rm -rf pr6-test && mkdir pr6-test && cd pr6-test

        git clone git@github.com:ozand/shared-knowledge-base.git .

        git fetch origin pull/6/head:pr6 && git checkout pr6

        python tools/kb_patterns.py find-universal

        python tools/kb_community.py report

        '
      result: All tests passed, clean cleanup
      reference: PR6_REVIEW.md
    example_2:
      pr: 'PR #4 - 5 new patterns'
      strategy: Temporary Clone
      commands: 'cd /tmp && mkdir pr4-test && cd pr4-test

        git clone git@github.com:ozand/shared-knowledge-base.git .

        git fetch origin pull/4/head:pr4 && git checkout pr4

        python tools/kb.py validate universal/patterns/*.yaml

        '
      result: Validation passed, no pollution in main repo
      reference: PARSER_PROJECT_AGENT_ANALYSIS.md
  safety_measures:
  - measure_1: Never test in main repository
    severity: critical
    reason: Risk of pollution and accidental commits
  - measure_2: Always delete test directory after testing
    severity: high
    reason: No leftover artifacts, save disk space
  - measure_3: Use /tmp, not home directory
    severity: medium
    reason: Cleaned on reboot, temporary by design
  - measure_4: Verify you're in test directory before destructive tests
    severity: high
    command: pwd | grep /tmp
  - measure_5: Don't create commits in test clone
    severity: medium
    reason: Can't push anyway, creates confusion
  troubleshooting:
  - issue_1: null
    name: Clone too slow
    solution: Use git worktree for large repos
    command: git worktree add ../repo-test pr-branch
  - issue_2: null
    name: Disk space concerns
    solution: Delete test directory immediately after use
    command: cd /tmp && rm -rf pr-test
  - issue_3: null
    name: Can't fetch PR branch
    solution: Verify PR number and repository permissions
    command: gh pr view <number> --json url
  - issue_4: null
    name: Tests modify files in clone
    solution: This is OK! Delete entire directory when done
    command: rm -rf /tmp/pr-test
  tools:
    git:
    - command: git clone
      purpose: Create isolated copy
    - command: git checkout
      purpose: Switch to PR branch
    - command: git fetch origin
      purpose: Get PR branch
    - command: git worktree add
      purpose: Linked working tree (alternative to clone)
    utilities:
    - command: cd /tmp
      purpose: Navigate to temp directory
    - command: mkdir && cd
      purpose: Create and enter test directory
    - command: rm -rf
      purpose: Clean up test directory
  success_criteria:
  - ✅ "Main repository not modified"
  - ✅ "No git pollution"
  - ✅ "Easy cleanup (delete directory)"
  - ✅ "Tests run successfully"
  - ✅ "No accidental commits"
  - ✅ "Can test destructive operations"
  when_to_use:
    use_cases:
    - case: PR Review
      strategy: Temporary Clone
      reason: Complete isolation
    - case: Testing experimental changes
      strategy: Temporary Clone
      reason: Can break things safely
    - case: Comparing multiple branches
      strategy: Multiple clones
      reason: Test simultaneously
    - case: Quick validation
      strategy: Git Stash (careful!)
      reason: Fast but risky

    prevention:
      - prevention: "Always use isolated environments for testing breaking changes"
        reason: "Prevents accidental damage to main development environment"
        how: "Use git worktree, temporary clone, or Docker containers"

      - prevention: "Clean up isolated test environments after testing"
        reason: "Prevents disk space waste and confusion"
        how: "Remove temporary clones, close worktrees after verification"

      - prevention: "Document which isolated testing strategy was used"
        reason: "Team members need to know how to reproduce test setup"
        how: "Add comment: 'Tested with: git worktree <branch>'"

      - prevention: "Never test breaking changes in main branch"
        reason: "Risk of accidentally committing broken code"
        how: "Always create test branch or use isolated environment"

      - prevention: "Use git stash carefully when testing locally"
        reason: "Easy to forget uncommitted changes"
        how: "Document stashed changes, verify stash list before testing"

      - prevention: "Verify test environment is properly isolated"
        reason: "Tests may use wrong dependencies if not isolated"
        how: "Check: 'git status', 'python -c import sys; print(sys.path)'"

      - prevention: "Set up automated testing in isolated CI/CD environments"
        reason: "Consistent isolation across all tests"
        how: "GitHub Actions, GitLab CI with isolated test runners"

  references:
  - title: Git Worktree Documentation
    url: https://git-scm.com/docs/git-worktree
  - title: Git Clone Documentation
    url: https://git-scm.com/docs/git-clone
  - title: PR6_REVIEW.md
    description: Real-world example of isolated testing
  domains:
    primary: testing
    secondary: []
languages:
- en
