# Agent Handoff Failure Modes Pattern
# Common submission failures when contributing to Shared KB

version: "1.0"
category: "agent-workflow"
last_updated: "2026-01-06"

patterns:
  - id: "AGENT-HANDOFF-FAILURE-001"
    title: "Common AGENT-HANDOFF-001 Submission Failures"
    severity: "high"
    scope: "universal"
    tags: ["agent", "submission", "failures", "handoff", "workflow", "quality"]

    problem: |
      Project Agents attempt to contribute patterns to Shared Knowledge Base
      following AGENT-HANDOFF-001 workflow, but submissions are incomplete or malformed.

      **Impact:**
      - Curator cannot access proposed content
      - Issues closed as incomplete
      - Pattern IDs must be reserved for resubmission
      - Delayed integration of valuable patterns
      - Contributor frustration

      **Common root causes:**
      1. Misunderstanding of "submission" vs "file reference"
      2. Assuming Curator has access to contributor's filesystem
      3. Following template structure but missing actual content
      4. Creating files in wrong project/repository

    symptoms:
      - Issue closed with "file not found"
      - Curator comment: "YAML file missing"
      - Pattern ID reserved but not created
      - Contributor resubmits with same mistake
      - Valuable patterns delayed or lost

    root_cause: |
      **Failure Mode 1: External File References**

      Contributor creates YAML file in their project's Shared KB submodule:
      ```
      /home/ozand/project/docs/knowledge-base/shared/universal/patterns/pattern.yaml
      ```

      Then submits GitHub issue with:
      ```markdown
      The complete YAML file is located at:
      docs/knowledge-base/shared/universal/patterns/pattern.yaml

      File size: 9.2KB
      Sections: 12 (symptoms, root_cause, solutions, ...)
      ```

      **Problem:** File exists in contributor's local repository, NOT in
      shared-knowledge-base remote repository. Curator cannot access it.

      **Why this happens:**
      - Contributor confuses "local submodule" with "remote repository"
      - Assumes Curator can see files they created locally
      - Doesn't understand git workflow (local changes not pushed)

      **Failure Mode 2: Missing Actual YAML Content**

      Issue describes pattern in detail:
      - Title, ID, severity, scope specified âœ“
      - Problem statement âœ“
      - Real-world examples âœ“
      - Solutions overview âœ“

      But: **Actual YAML entry content is MISSING** âœ—

      Issue says: "The complete YAML file is located at: path/to/file.yaml"

      **Problem:** Curator needs full YAML to validate and integrate.
      Description â‰  Actual YAML content.

      **Failure Mode 3: In AGENT-HANDOFF-001 Format, But Incomplete**

      Contributor follows template:
      ```markdown
      ## Proposed Entry
      **ID:** XXX-YYY
      **Title:** Pattern Title
      **Category:** category-name
      **Severity:** Medium
      **Scope:** Universal
      ```

      But stops there, doesn't include:
      ```yaml
      version: "1.0"
      category: "category-name"
      last_updated: "2026-01-06"

      patterns:
        - id: "XXX-YYY"
          title: "Pattern Title"
          problem: |
            Full problem description
          # ... rest of YAML
      ```

      **Problem:** Follows structure but missing actual YAML entry.

    solution: |
      **Correct Submission Format:**

      ## âœ… FULL YAML EMBEDDED IN ISSUE BODY

      ```markdown
      ---
      **Created By:** ğŸ¤– Claude Code (Project Agent)
      **Project:** PROJECT_NAME
      **Date:** 2026-01-06
      **Validation:** âœ… Validated locally
      ---

      ## Proposed KB Entry

      **Full YAML content:**

      ```yaml
      version: "1.0"
      category: "category-name"
      last_updated: "2026-01-06"

      patterns:
        - id: "PATTERN-001"
          title: "Pattern Title"
          severity: "high"
          scope: "universal"
          tags: ["tag1", "tag2", "tag3"]

          problem: |
            Detailed problem description
            with multiple paragraphs
            and examples

          root_cause: |
            Explanation of root cause
            with technical details

          solution: |
            Step-by-step solution

          prevention:
            - "Prevention tip 1"
            - "Prevention tip 2"

          code_example: |
            ```bash
            # Code examples
            command here
            ```

          best_practices: |
            - Best practice 1
            - Best practice 2

          real_world_examples: |
            example_1:
              scenario: "Real-world scenario"
              solution: "What worked"
      ```
      ```

      **Key points:**
      1. âœ… **FULL YAML in issue body** - not just file path
      2. âœ… **Complete entry** - all required fields
      3. âœ… **Proper indentation** - copy from validated file
      4. âœ… **Validated locally** - mention validation passed

      ## âŒ WRONG: File Path Only

      ```markdown
      ## Proposed Entry

      **ID:** PATTERN-001
      **Title:** Pattern Title

      The complete YAML file is located at:
      docs/knowledge-base/shared/universal/patterns/pattern.yaml

      File size: 9.2KB
      Sections: 12
      ```

      **Why this is wrong:**
      - Curator cannot access contributor's local filesystem
      - File doesn't exist in shared-knowledge-base repository
      - Issue will be closed as incomplete
      - Pattern ID must be reserved for future submission

    prevention:
      - prevention: "Always embed full YAML in issue body"
        reason: "Curator can access issue content, not contributor's files"

      - prevention: "Validate YAML locally before submitting"
        workflow: |
          1. Create YAML file locally
          2. Validate: python tools/kb.py validate pattern.yaml
          3. If validation fails, fix and re-validate
          4. Once valid, copy FULL content to issue body

      - prevention: "Follow AGENT-HANDOFF-001 template completely"
        check: |
          Does issue include:
          - âœ“ Attribution (agent, project, date)
          - âœ“ FULL YAML content (not just file path)
          - âœ“ All required YAML fields
          - âœ“ Validation confirmation

      - prevention: "Test submission format"
        test: |
          Before submitting, ask:
          "If Curator ONLY has this issue, can they integrate the pattern?"

          If NO: Add missing content to issue body

    real_world_examples:
      failure_1_external_file_reference:
        issue: "#13: PRE-COMMIT-001"
        submission: |
          "The complete YAML file is located at:
           docs/knowledge-base/shared/universal/patterns/pre-commit-exclude-external.yaml

           File size: 9.2KB
           Sections: 12 (symptoms, root_cause, ...)"

        problem: "File doesn't exist in shared-knowledge-base repository"

        curator_action:
          - "Added comment: file not found"
          - "Reserved pattern ID PRE-COMMIT-001"
          - "Closed as incomplete"

        correct_approach: |
          Should have been:
          ```markdown
          ## Proposed Entry

          **Full YAML content:**

          ```yaml
          version: "1.0"
          category: "pre-commit-patterns"
          # ... complete 9.2KB YAML content
          ```
          ```

      failure_2_missing_yaml_content:
        issue: "#12: PY-IMPORT-005"
        submission: |
          Provided:
          - Title, ID, severity âœ“
          - Problem description âœ“
          - Real-world example âœ“
          - File path: python/errors/module-import-tool-scripts.yaml
          - File size: 5.6KB

          Missing:
          - âœ— Actual YAML entry content
          - âœ— Complete pattern structure

        problem: "Description of pattern â‰  actual YAML entry"

        curator_action:
          - "Commented: incomplete - YAML content missing"
          - "Reserved PY-IMPORT-005 for future submission"
          - "Closed issue"

        lesson: "Describe what pattern will contain â‰  include actual pattern YAML"

      failure_3_partial_template_follow:
        issue: "#14: YAML-VALIDATION-001"
        submission: |
          Followed template:
          - **ID:** YAML-VALIDATION-001 âœ“
          - **Title:** YAML Validation in Automation âœ“
          - **Category:** Python âœ“
          - **File location:** path/to/file.yaml

          But: YAML content itself not in issue body

        problem: "Template structure â‰  complete YAML entry"

        curator_action:
          - "Explained: need full YAML in issue body"
          - "Reserved YAML-VALIDATION-001"
          - "Closed as incomplete"

        value: "Pattern would be valuable if properly submitted"

    code_example: |
      ```bash
      # Complete correct submission workflow

      # 1. Create YAML file locally
      cat > universal/patterns/my-pattern.yaml << 'EOF'
      version: "1.0"
      category: "pattern-category"
      last_updated: "2026-01-06"

      patterns:
        - id: "PATTERN-001"
          title: "Pattern Title"
          # ... complete content
      EOF

      # 2. Validate locally
      python tools/kb.py validate universal/patterns/my-pattern.yaml
      # Output: âœ“ Validation passed

      # 3. Create GitHub issue with FULL YAML
      gh issue create \
        --title "Add PATTERN-001: Pattern Title" \
        --label "agent:claude-code" \
        --label "project:MYPROJECT" \
        --label "kb-improvement" \
        --body-file issue-template.md

      # issue-template.md contains:
      # - Attribution (agent, project, date)
      # - FULL YAML content (copied from validated file)
      # - Validation confirmation

      # Result: Curator can immediately review and integrate
      ```

    troubleshooting:
      - symptom: "Issue closed as 'incomplete'"
        check: "Did you include full YAML in issue body?"
        fix: "Resubmit with complete YAML content embedded"

      - symptom: "Curator comment: 'file not found'"
        check: "Did you reference external file path?"
        fix: "Copy full YAML content into issue body"

      - symptom: "Pattern ID reserved"
        meaning: "ID held for your future resubmission"
        action: "Resubmit with complete content, use reserved ID"

      - symptom: "Unclear what to include"
        rule: "Include everything needed for integration"
        checklist:
          - "Full YAML entry (not just description)"
          - "All required fields"
          - "Code examples"
          - "Validation confirmation"

    best_practices:
      - practice: "Embed full YAML in issue body"
        reason: "Curator can access issue, not contributor's files"

      - practice: "Validate locally before submission"
        reason: "Catch errors early, don't waste Curator's time"

      - practice: "Use issue templates"
        reason: "Ensure all required information included"

      - practice: "Test submission format"
        test: "Ask: Can Curator integrate with ONLY this issue?"

      - practice: "Mention validation status"
        reason: "Curator knows YAML syntax is correct"

    lessons_learned: |
      **From processing 4 incomplete submissions (issues #11-14):**

      **Common mistakes:**
      1. Referencing files in local submodule (3/4 cases)
      2. Not including actual YAML content (4/4 cases)
      3. Providing description instead of YAML (4/4 cases)
      4. Following template but incomplete (2/4 cases)

      **Pattern value:**
      - Issue #12: PY-IMPORT-005 - Valuable (unique, not duplicate)
      - Issue #13: PRE-COMMIT-001 - Valuable (high impact, common issue)
      - Issue #14: YAML-VALIDATION-001 - Valuable (complements YAML-001)

      **Impact:**
      - All 3 patterns would have been accepted if properly submitted
      - Delayed integration due to format issues
      - Curator time wasted on incomplete submissions

      **Prevention:**
      - Add validation step to AGENT-HANDOFF-001
      - Include examples of complete submissions
      - Template check: "Full YAML embedded?"
      - Pre-submission checklist

    anti_patterns:
      - pattern: "Reference file path instead of embedding YAML"
        consequence: "Issue closed as incomplete, resubmission required"

      - pattern: "Describe pattern without including YAML"
        consequence: "Curator cannot validate or integrate"

      - pattern: "Follow template structure but skip actual content"
        consequence: "Incomplete submission, delayed integration"

      - pattern: "Assume Curator has access to contributor's files"
        consequence: "File not found error, confusion"

      - pattern: "Create file in wrong repository/project"
        consequence: "File doesn't exist in shared-knowledge-base"

    when_to_use: |
      Use this pattern when:
      - Reviewing incomplete GitHub issues
      - Creating submission guidelines
      - Updating AGENT-HANDOFF-001 documentation
      - Training Project Agents on contribution workflow
      - Debugging why submissions rejected

    related_patterns:
      - AGENT-HANDOFF-001 (Correct submission workflow)
      - CURATOR-ISSUE-TRIAGE-001 (How Curator handles issues)
      - CURATOR-DECISION-001 (Accept/reject decision framework)
      - AGENT-ROLE-SEPARATION-001 (Project Agent vs Curator roles)
      - YAML-001 (YAML syntax validation)

    references:
      - "Issue #11: Partially correct format (files existed, but superseded)"
      - "Issue #12: PY-IMPORT-005 (incomplete, reserved)"
      - "Issue #13: PRE-COMMIT-001 (incomplete, reserved)"
      - "Issue #14: YAML-VALIDATION-001 (incomplete, reserved)"
      - "AGENT-HANDOFF-001 workflow: agent-handoff.yaml"

    metadata:
      created_at: "2026-01-06"
      author: "Shared KB Curator"
      reusable: true
      severity_level: 1
      difficulty: "elementary"
      pattern_type: "anti-pattern"
      applicable_to: ["project-agents", "curators", "contributors"]
