# Pull Request Review Pattern for Shared Knowledge Base
# Systematic process for reviewing PRs before merge

version: "1.0"
category: "knowledge-base"
last_updated: "2026-01-06"

patterns:
  - id: "PR-REVIEW-001"
    title: "Pull Request Review Process for Shared Knowledge Base"
    severity: "high"
    scope: "universal"
    tags: ["pr", "review", "quality-control", "workflow", "github", "validation"]

    problem: |
      Pull Requests to Shared Knowledge Base require thorough review before merge to:
      - Prevent duplicate entries from being added
      - Ensure code quality standards are maintained
      - Verify no breaking changes to v5.1 tools
      - Validate YAML syntax and structure
      - Test all affected functionality

      **Risks of inadequate review:**
      - Duplicates pollute the knowledge base
      - Low-quality entries reduce searchability
      - Breaking changes block all v5.1 features
      - Invalid YAML prevents indexing
      - Poor solutions mislead users

    symptoms:
      - PRs merged without proper validation
      - Duplicate patterns appear in KB
      - Tools break after changes
      - YAML validation errors
      - Low-quality content accepted

    root_cause: |
      1. No systematic review process defined
      2. Curator not explicitly responsible for PR review
      3. Missing standardized review checklist
      4. No testing procedures documented
      5. Unclear decision criteria (approve vs request changes)

    solution: |
      **PR Review Process for Shared KB Curator:**

      ## Phase 1: Access & Categorize (5 minutes)

      1. **Get PR details:**
         ```bash
         gh pr view <number> --json title,body,additions,deletions,files,author
         gh pr diff <number> --name-only
         ```

      2. **Categorize PR type:**
         - **Bug Fix:** Resolves error/issue
         - **New Pattern:** Adds knowledge entry
         - **Tool Update:** Modifies kb*.py tools
         - **Documentation:** Updates docs
         - **Refactoring:** Code reorganization

      ## Phase 2: Clone & Isolate (2 minutes)

      ```bash
      cd /tmp
      rm -rf pr-test
      mkdir pr-test && cd pr-test
      git clone git@github.com:ozand/shared-knowledge-base.git .
      git fetch origin pull/<number>/head:pr-branch
      git checkout pr-branch
      ```

      **Why isolate:** Prevent contamination of main repository

      ## Phase 3: Validate & Test (10-20 minutes)

      **For Bug Fixes:**
      ```bash
      # Reproduce issue before fix (document in review)
      # Apply fix
      # Verify fix works
      # Test for regressions
      ```

      **For New Patterns (CRITICAL):**
      ```bash
      # 1. Validate YAML syntax
      python tools/kb.py validate <changed-files>

      # 2. Check for duplicates (EXHAUSTIVE!)
      python tools/kb.py search "<keyword1>"
      python tools/kb.py search "<keyword2>"
      python tools/kb.py search "<keyword3>"
      # Use multiple related keywords

      # 3. Verify completeness
      # - All required fields present
      # - Examples provided
      # - Cross-references added
      # - Tags appropriate
      ```

      **For Tool Updates:**
      ```bash
      # Test all v5.1 tools
      python tools/kb_patterns.py find-universal
      python tools/kb_community.py report
      python tools/kb_predictive.py suggest-entries
      python tools/kb_issues.py scan

      # Check for import errors
      python -c "from tools.kb_config import KBConfig"
      ```

      **For Documentation:**
      ```bash
      # Verify accuracy
      # Check for outdated info
      # Test examples
      # Validate links
      ```

      ## Phase 4: Code Quality Review (5-10 minutes)

      **Checklist:**
      - ‚úÖ PEP 8 compliant (Python)
      - ‚úÖ Type hints used
      - ‚úÖ Docstrings present
      - ‚úÖ Error handling
      - ‚úÖ No hard-coded paths
      - ‚úÖ Clear variable names
      - ‚úÖ Comments where needed

      ## Phase 5: Breaking Changes Check (5 minutes)

      ```bash
      # Test basic KB operations
      python tools/kb.py validate .
      python tools/kb.py search "test"
      python tools/kb.py index -v

      # Check backward compatibility
      # - Old commands still work?
      # - Config file format changed?
      # - API signatures modified?
      ```

      ## Phase 6: Decision & Document (10 minutes)

      **Create Review Document:**
      - File: `PR<NUMBER>_REVIEW.md`
      - Include:
        - Executive Summary (rating, decision)
        - Problem Analysis
        - Testing Results (before/after)
        - Code Quality Review
        - Issues Found (if any)
        - Recommendation

      **Decision Framework:**
      - **APPROVE:** Meets all criteria, tested, no issues
      - **APPROVE WITH SUGGESTIONS:** Good + minor non-blocking improvements
      - **REQUEST CHANGES:** Blocking issues must be fixed
      - **COMMENT ONLY:** Questions/discussion needed

      **Rating Scale:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (1-5)

      ## Phase 7: Post Review (2 minutes)

      ```bash
      # Post comment on PR
      gh pr comment <number> --body "<review summary>"

      # Official review (if not own PR)
      gh pr review <number> --approve --body "<review>"
      # OR
      gh pr review <number> --request-changes --body "<issues>"
      ```

      **IMPORTANT:** Cannot approve own PRs (GitHub restriction)

      **Template:**
      ```markdown
      ## ‚úÖ Shared KB Curator Review: [APPROVE/REQUEST CHANGES]

      **Rating:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (X/5)

      ### üß™ Testing Results
      - ‚úÖ All tests passed
      - ‚úÖ No breaking changes
      - ‚úÖ Tools working correctly

      ### ‚≠ê Code Quality
      - ‚úÖ PEP 8 compliant
      - ‚úÖ Type hints used
      - ‚úÖ Well documented

      ### ‚úÖ Review Checklist
      - ‚úÖ Problem clearly defined
      - ‚úÖ Solution tested
      - ‚úÖ No duplicates
      - ‚úÖ YAML validation passes

      ### üéØ Decision
      **[MERGE/CHANGE/DISCUSS]**

      Full review: PR#_REVIEW.md
      ```

    review_checklist:
      mandatory:
        - item: "Access PR details with gh pr view"
          critical: true

        - item: "Clone and test in isolated environment (/tmp)"
          critical: true

        - item: "Validate YAML syntax for all changed files"
          critical: true
          command: "python tools/kb.py validate <files>"

        - item: "Check for duplicates (CRITICAL for new patterns)"
          critical: true
          command: "python tools/kb.py search <keywords>"

        - item: "Test all affected v5.1 tools"
          critical: true
          tools:
            - "kb_patterns.py"
            - "kb_community.py"
            - "kb_predictive.py"
            - "kb_issues.py"

        - item: "Code quality review (PEP 8, types, docs)"
          critical: false

        - item: "Verify no breaking changes"
          critical: true

        - item: "Create PR#_REVIEW.md document"
          critical: true

        - item: "Post review comment on GitHub"
          critical: true

      pr_specific:
        bug_fixes:
          - "Reproduce issue before fix"
          - "Verify fix resolves issue"
          - "Test for regressions"
          - "Check edge cases"

        new_patterns:
          - "Validate YAML structure"
          - "Exhaustive duplicate check (3+ keywords)"
          - "Verify all required fields"
          - "Check for cross-references"
          - "Assess universality claim"

        tool_updates:
          - "Test all v5.1 tools"
          - "Check import statements"
          - "Verify backward compatibility"
          - "Update documentation"

        documentation:
          - "Verify accuracy"
          - "Check for outdated info"
          - "Test examples"
          - "Validate links"

    common_issues:
      issue_1:
        name: "Duplicate Content"
        severity: "high"
        detection: "kb.py search finds similar entries"
        action: "REQUEST CHANGES - Merge or differentiate"

      issue_2:
        name: "Invalid YAML Syntax"
        severity: "high"
        detection: "kb.py validate fails"
        action: "REQUEST CHANGES - Fix YAML errors"

      issue_3:
        name: "Breaking Changes"
        severity: "critical"
        detection: "Tools fail after changes"
        action: "REQUEST CHANGES - Fix backward compatibility"

      issue_4:
        name: "Missing Required Fields"
        severity: "medium"
        detection: "id, title, problem, solution missing"
        action: "REQUEST CHANGES - Add required fields"

      issue_5:
        name: "Poor Code Quality"
        severity: "low"
        detection: "No type hints, missing docs, PEP 8 violations"
        action: "APPROVE WITH SUGGESTIONS - Note improvements"

    time_estimate:
      access_categorize: "5 minutes"
      clone_isolate: "2 minutes"
      validate_test: "10-20 minutes"
      code_quality_review: "5-10 minutes"
      breaking_changes_check: "5 minutes"
      decision_document: "10 minutes"
      post_review: "2 minutes"

      total_min: "40 minutes"
      total_max: "65 minutes"
      average: "50 minutes"

    examples:
      example_1:
        pr: "PR #6 - Add missing kb_config.py module"
        type: "Bug Fix"
        decision: "APPROVE ‚≠ê‚≠ê‚≠ê‚≠ê¬Ω"
        review: "PR6_REVIEW.md"
        highlights:
          - "Critical blocker for all v5.1 tools"
          - "Well-tested (all tools working)"
          - "Code quality excellent"
          - "Minor: Code duplication acceptable"
        url: "https://github.com/ozand/shared-knowledge-base/pull/6"

      example_2:
        pr: "PR #4 - Add 5 universal patterns from PARSER project"
        type: "New Patterns"
        decision: "APPROVE ‚≠ê‚≠ê‚≠ê‚≠ê"
        review: "PARSER_PROJECT_AGENT_ANALYSIS.md"
        highlights:
          - "5 unique patterns, no duplicates"
          - "All patterns high quality"
          - "Real-world tested"
          - "Minor: DOC-REORG-001 overlaps with PROJECT-ORG-001"
        url: "https://github.com/ozand/shared-knowledge-base/pull/4"

    best_practices:
      - "Always test in isolated environment (/tmp)"
      - "Be exhaustive with duplicate checking (use multiple keywords)"
      - "Create detailed review documents (PR#_REVIEW.md)"
      - "Focus on critical issues over minor style"
      - "Test all v5.1 tools for any code changes"
      - "Document testing procedures thoroughly"
      - "Be constructive and specific in feedback"
      - "Approve when good enough (don't block for minor issues)"

    anti_patterns:
      - ‚ùå "Reviewing PR in main repository (not isolated)"
      - ‚ùå "Skipping duplicate check for new patterns"
      - ‚ùå "Not testing v5.1 tools after code changes"
      - ‚ùå "Approving without creating review document"
      - ‚ùå "Focusing on style over substance"
      - ‚ùå "Requesting changes for minor issues"
      - ‚ùå "Approving own PRs (GitHub restriction)"

    required_tools:
      - tool: "GitHub CLI (gh)"
        purpose: "Access PR details, post reviews"
        verify: "gh --version"

      - tool: "Git"
        purpose: "Clone PR branches"
        verify: "git --version"

      - tool: "Python 3.8+"
        purpose: "Run kb.py tools"
        verify: "python --version"

      - tool: "kb.py"
        purpose: "Validate, search, index"
        verify: "python tools/kb.py --version"

    success_criteria:
      - ‚úÖ "All validation checks pass"
      - ‚úÖ "No duplicates introduced"
      - ‚úÖ "Code quality meets standards"
      - ‚úÖ "No breaking changes"
      - ‚úÖ "All v5.1 tools work correctly"
      - ‚úÖ "Review document created (PR#_REVIEW.md)"
      - ‚úÖ "GitHub comment posted on PR"

    related_patterns:
      - id: "YAML-001"
        title: "Common YAML Syntax Errors in Knowledge Base Entries"

      - id: "AGENT-HANDOFF-001"
        title: "Cross-Repository Agent Collaboration Pattern"

      - id: "PROJECT-ORG-002"
        title: "Git Submodule vs Clone Decision Matrix"

      - id: "QUALITY-PROCESS-001"
        title: "Quality vs Process Separation in Contribution Evaluation"
        relationship: "complementary"
        explanation: |
          QUALITY-PROCESS-001 provides decision framework for evaluating
          contributions (quality vs process matrix). PR-REVIEW-001 provides
          step-by-step review process. Use both together: QUALITY-PROCESS
          for WHAT decision to make (merge/close/recreate), PR-REVIEW for
          HOW to conduct the review.

    prevention:
      - prevention: "Always use isolated testing environment for PR review (Strategy 1)"
        reason: "Prevents repository contamination, build artifacts, accidental commits"
        how: "cd /tmp && mkdir pr-test && cd pr-test && git clone <repo> . && git checkout pr-branch"
      - prevention: "Validate YAML entries before approving PR"
        reason: "Invalid YAML breaks KB tools, prevents indexing, corrupts knowledge base"
        how: "Run: python tools/kb.py validate . && python tools/kb.py index --test"
      - prevention: "Test code examples in PR before merging"
        reason: "Untested code examples may contain errors, mislead users"
        how: "Copy code blocks to test file, run, verify output matches documentation"
      - prevention: "Check for duplicate or similar patterns before accepting new entries"
        reason: "Prevents KB bloat, maintains consistency, avoids redundancy"
        how: "Search KB: python tools/kb.py search '<pattern keywords>'"
      - prevention: "Verify all required fields present in YAML entries"
        reason: "Missing fields cause validation failures, incomplete documentation"
        how: "Check: version, category, last_updated, id, title, severity, scope, problem, solution"
      - prevention: "Review attribution for all agent-contributed PRs"
        reason: "Ensures proper credit, tracks agent contributions, maintains accountability"
        how: "Check PR has agent labels, attribution section, Co-Authored-By in commits"
      - prevention: "Set SLA for PR reviews (24h for triage, 48h for decision)"
        reason: "Prevents contributor frustration, maintains momentum in KB development"
        how: "Daily review of open PRs, prioritize by submission date, label with review-status"
      - prevention: "Provide constructive feedback with specific improvement steps"
        reason: "Generic feedback doesn't help contributors improve quality"
        how: "Comment: 'Line 45: Add code example for solution section' instead of 'incomplete'"

    references:
      - title: "GitHub PR Review Documentation"
        url: "https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests"

      - title: "GitHub CLI Documentation"
        url: "https://cli.github.com/manual/gh_pr_review"

      - title: "PEP 8 Style Guide"
        url: "https://pep8.org/"

languages: [en]
