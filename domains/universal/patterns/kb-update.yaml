# Shared KB Update Process for Projects

version: "1.0"
category: "knowledge-base"
last_updated: "2026-01-06"

patterns:
  - id: "KB-UPDATE-001"
    title: "Shared KB Update Process for Projects"
    severity: "high"
    scope: "universal"
    tags: ["updates", "maintenance", "synchronization", "version-control"]

    problem: |
      Projects using Shared Knowledge Base need to stay current with
      new patterns and improvements. However, there's no systematic
      update mechanism, and agents don't know when their local KB is stale.

      **Key Issues:**
      - No version tracking
      - No update notifications
      - Manual git operations required
      - Agents unaware of new patterns
      - Knowledge gap grows over time

    impact: |
      - Projects work with outdated knowledge
      - Missing new patterns and improvements
      - Repeating solved problems
      - Inconsistent solutions across projects

    solution: |
      Implement systematic update process with automated checking
      and clear update workflows for different installation methods.

    workflows: "@references/KB-UPDATE-001-workflows.md"

    troubleshooting: "@references/KB-UPDATE-001-troubleshooting.md"

    success_examples: "@references/KB-UPDATE-001-success-examples.md"

    agent_commands: "@references/KB-UPDATE-001-agent-commands.md"

    best_practices:
      practice_1_automate_checks: |
        **Always enable automatic update checks on bootstrap**

        Rationale: Agents are automatically notified when updates are available,
        reducing the chance of working with stale knowledge.

        Implementation:
        - Ensure AGENT-AUTO-001 bootstrap is configured
        - Run `python tools/kb-agent-bootstrap.py` on session start
        - Or integrate into project's agent startup script

      practice_2_update_before_major_work: |
        **Update Shared KB before starting major work**

        Rationale: Ensures you have access to the latest patterns and solutions,
        especially for critical tasks.

        Examples:
        - Before implementing authentication system
        - Before troubleshooting complex database issues
        - Before performance optimization work
        - Before onboarding new developers

      practice_3_document_local_changes: |
        **Never modify Shared KB files directly**

        Rationale: Local modifications create merge conflicts and prevent updates.

        Instead:
        - Add project-specific patterns to project's local KB
        - Use tags: local_only: true
        - Contribute universal patterns via GitHub Issues

      practice_4_test_after_update: |
        **Test critical patterns after update**

        Rationale: New versions may have changes that affect existing workflows.

        Checklist:
        - Verify key patterns still work
        - Check for deprecated patterns
        - Review new patterns added
        - Update project documentation if needed

      practice_5_rollback_plan: |
        **Know how to rollback before updating**

        Rationale: If update breaks something, you need quick recovery.

        Preparation:
        - Commit project state before updating Shared KB
        - Know rollback commands for your setup (submodule vs clone)
        - Test rollback process in non-critical environment

      practice_6_update_frequency: |
        **Match update frequency to project activity**

        Guidelines:
        - Active projects: Weekly or before major work
        - Maintenance projects: Monthly
        - Critical systems: Before any deployment
        - Learning/onboarding: Always use latest

    anti_patterns:
      anti_pattern_1_ignore_updates:
        wrong: "Never updating Shared KB"
        consequences:
          - "Missing new patterns and improvements"
          - "Working with outdated solutions"
          - "Repeating solved problems"
          - "Knowledge gap grows over time"

        correct: "Regular updates following recommended frequency"

      anti_pattern_2_local_modifications:
        wrong: "Modifying Shared KB files directly"
        consequences:
          - "Merge conflicts on every update"
          - "Changes lost on update"
          - "Cannot update cleanly"
          - "Violates Shared KB principles"

        correct: "Use project-local KB for project-specific patterns"

      anti_pattern_3_blind_update:
        wrong: "Updating without reviewing changes"
        consequences:
          - "Surprise breaking changes"
          - "Missed migration requirements"
          - "New patterns not discovered"

        correct: "Check what changed, then update"
        steps:
          - "Run: python tools/kb.py check-updates"
          - "Review commit summaries"
          - "Plan for any breaking changes"
          - "Then update"

      anti_pattern_4_update_in_production:
        wrong: "Updating Shared KB during critical production work"
        consequences:
          - "Unexpected behavior changes"
          - "Production downtime risk"
          - "Rollback complexity"

        correct: "Update in development/staging first, test, then production"

    success_examples:
      See "@references/KB-UPDATE-001-success-examples.md" for detailed examples.

    agent_commands: "@references/KB-UPDATE-001-agent-commands.md"

    integration_points:
      point_1_automation: |
        **Auto-Check on Bootstrap (AGENT-AUTO-001)**

        Update checking is integrated into agent bootstrap:
        - Automatically runs on session start
        - Non-blocking (doesn't fail if network unavailable)
        - Shows clear update notifications
        - Provides update commands

        Script: tools/kb-agent-bootstrap.py
        Function: check_kb_updates()

      point_2_command_line: |
        **Manual Check Command**

        Check for updates anytime:
        ```bash
        python tools/kb.py check-updates
        ```

        Features:
        - Detects submodule vs clone
        - Shows recent commits
        - Provides update command
        - Shows recommended frequency

      point_3_ci_cd: |
        **CI/CD Integration**

        Check for updates in CI/CD pipeline:
        ```yaml
        # Example GitHub Actions
        - name: Check Shared KB Updates
          run: |
            python docs/knowledge-base/shared/tools/kb.py check-updates
        ```

        Use cases:
        - Warn about outdated KB in builds
        - Suggest updates before deployment
        - Track update compliance

    related_patterns:
      - id: "AGENT-AUTO-001"
        title: "Agent Auto-Configuration from Shared KB"
        relationship: "integrates"
        explanation: |
          KB-UPDATE-001's automated check is integrated into AGENT-AUTO-001
          bootstrap process, ensuring agents are notified on session start.

      - id: "SHARED-KB-SETUP-001"
        title: "Shared KB Sparse Checkout Setup"
        relationship: "complementary"
        explanation: |
          SHARED-KB-SETUP-001 configures sparse checkout to exclude Curator
          files. KB-UPDATE-001 shows how to update while maintaining sparse checkout.

      - id: "KB-INDEX-001"
        title: "Supporting Multiple Entry Keys"
        relationship: "related"
        explanation: |
          KB-INDEX-001 ensures both 'errors' and 'patterns' keys are indexed.
          Updates to KB indexing are handled via KB-UPDATE-001 workflow.

    prevention:
      - prevention: "Always check for Shared KB updates before making local changes"
        reason: "Local changes may conflict with upstream updates, causing merge conflicts"
        how: "Run: cd .kb/shared && git fetch && git log HEAD..origin/main --oneline"
      - prevention: "Use sparse checkout to exclude Curator-specific files from projects"
        reason: "Projects shouldn't see Curator agent files, reduces confusion and token usage"
        how: "git sparse-checkout set /* !curator !/universal/agent-instructions"
      - prevention: "Test KB changes in isolated environment before pulling into main project"
        reason: "Broken KB entries can break agents that depend on them"
        how: "Clone Shared KB to /tmp/, apply changes, validate, test, then PR"
      - prevention: "Rebuild KB index after updating Shared KB"
        reason: "New entries won't be searchable until index is rebuilt"
        how: "Run: python tools/kb.py index --force -v"
      - prevention: "Document breaking changes in KB entries (version field)"
        reason: "Projects need to know when updates require action on their side"
        how: "Update version field, add migration guide, announce in shared-kb repo"
      - prevention: "Set up automatic update checking in agent bootstrap process"
        reason: "Manual update checking is error-prone and easily forgotten"
        how: "Add to .kb/shared/tools/kb-agent-bootstrap.py: check_kb_updates() function"
      - prevention: "Keep Shared KB as read-only submodule in projects"
        reason: "Prevents accidental commits to Shared KB from project context"
        how: "git submodule add --bare git@github.com:user/shared-kb.git .kb/shared"
      - prevention: "Contribute changes upstream via GitHub Issues, not direct commits"
        reason: "Maintains quality control, allows Curator review, prevents low-quality entries"
        how: "Follow AGENT-HANDOFF-001 workflow: validate → create issue → wait for Curator"

    references:
      - title: "SHARED_KB_UPDATE_MECHANISMS_ANALYSIS.md"
        description: "Detailed analysis of update mechanisms and gaps"

      - title: "SUBMODULE_VS_CLONE.md"
        description: "Comparison of submodule vs clone approaches"

      - title: "SUBMODULE_CONTEXT_CONTAMINATION_ANALYSIS.md"
        description: "Sparse checkout implementation to exclude Curator files"

      - title: "VPS_MIGRATION_V2_TO_V3_ANALYSIS.md"
        description: "Complete analysis of successful v2.0 to v5.1 migration"

      - title: "tools/kb.py check-updates"
        description: "Command-line tool to check for updates"

      - title: "tools/kb-agent-bootstrap.py"
        description: "Bootstrap script with automatic update checking"

    version_history:
      - version: "1.1"
        date: "2026-01-06"
        changes:
          - "Added example_3: VPS migration v2.0 to v5.1"
          - "Documented complete migration workflow with 10 steps"
          - "Added before/after comparison and statistics"
          - "Added 5 verification tests"
          - "Added next steps for v5.1 features (sparse checkout, auto-update)"

      - version: "1.0"
        date: "2026-01-06"
        changes:
          - "Initial pattern creation"
          - "Documented workflows for submodule, clone, sparse checkout"
          - "Added troubleshooting section with 6 issues"
          - "Added best practices and anti-patterns"
          - "Integrated with AGENT-AUTO-001 bootstrap"
          - "Added success examples 1 and 2"
